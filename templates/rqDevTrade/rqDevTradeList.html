<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="../js/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="../css/compManager.css"/>
		<link rel="stylesheet" type="text/css" href="../js/pace/pace-theme-flash.min.css"/>
		<script src="../js/pace/pace.min.js" type="text/javascript" charset="utf-8"></script>
		<title>燃气设备买卖列表</title>
	</head>
	<body style="background:#f2f2f2;">
		<div class="layui-fluid" style="margin-top:15px;">
			<div class="layui-row">
				<div class="layui-card">
					<div class="layui-card-header posRel">
						<span class="itemDivs">燃气设备买卖管理</span>
						<a id="addTruckTrade" class="posAbs newAddBtn" href="javascript:void(0)"><i class="layui-icon layui-icon-add-circle"></i>添加燃气设备买卖</a>
					</div>
					<div class="layui-card-body">
						<div class="filterWrap layui-form layui-clear" style="margin-bottom: 20px;margin-top: 10px;">
							<div class="filterItem" style="margin-right: 5px;">
								<input type="radio" name="validStatus" value="0" title="未审核" lay-filter="checkStaFilter" checked/>
								<input type="radio" name="validStatus" value="1" title="审核通过" lay-filter="checkStaFilter"/>
								<input type="radio" name="validStatus" value="2" title="审核未通过" lay-filter="checkStaFilter"/>
							</div>
							<div class="filterItemSel layui-form" style="width: 150px;">
								<select id="compNameSel" lay-filter="compNameSel">
									<option value="">请选择公司</option>
								</select>
							</div>
							<div class="filterItemSel layui-form" style="width: 170px;">
								<select id="rqDevLmSel" lay-filter="rqDevLmSel">
									<option value="">请选择设备类目</option>
								</select>
							</div>
							<div class="filterItemSel layui-form" style="width: 170px;">
								<select id="rqDevTypeSel" lay-filter="rqDevTypeSel">
									<option value="">请选择设备类型</option>
								</select>
							</div>
							<div class="filterItem">
								<button id="queryBtn" class="layui-btn"><i class="layui-icon layui-icon-search"></i></button>
							</div>
							<div class="filterItem">
								<p>
									<span class="currStaSpan passBg"></span>
									<span>表示审核通过</span>
								</p> 
								<p>
									<span class="currStaSpan noPassBg"></span>
									<span>表示审核未通过</span>
								</p>
							</div>
						</div>
						<table id="truckTradeTab" class="layui-table" lay-filter="truckTradeTab"></table>
					</div>
				</div>
			</div>
		</div>
		
		<script type="text/javascript" src="../js/jquery-1.8.3.min.js" charset="utf-8"></script>
		<script src="../js/layui/layui.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			var compId = '',lmId = '',zlId='',checkSta=0,checkFlag = false,globalOpts = '',addEditFlag = false;
			layui.config({
				base: '/js/frame/js/'
			}).use(['layer','table','form','basicInfo'],function(){
				var layer = layui.layer,table = layui.table,form = layui.form,basicInfo = layui.basicInfo;
				form.on('radio(checkStaFilter)',function(data){
					checkSta = data.value;
					page.loadRqDevTradeList();
				});
				//选择公司
				form.on('select(compNameSel)',function(data){
					data.value == '' ? compId = '' : compId = data.value;
					page.loadRqDevTradeList();
				});
				//选择燃气设备类目
				form.on('select(rqDevLmSel)',function(data){
					data.value == '' ? lmId = '' : lmId = data.value;
					page.loadRqDevTradeList();
				});
				//选择燃气设备类型
				form.on('select(rqDevTypeSel)',function(data){
					data.value == '' ? zlId = '' : zlId = data.value;
					page.loadRqDevTradeList();
				});
				var page = {
					init : function(){
						this.bindEvent();
						basicInfo.getCompanyList();
						basicInfo.getRqDevLm();
						basicInfo.getRqDevType();
						this.loadRqDevTradeList();
					},
					bindEvent : function(){
						var _this = this;
						$('#addTruckTrade').on('click',function(){
							globalOpts = 'addBtn';
							_this.commonLayer();
						});
					},
					commonLayer : function(){
						addEditFlag = true;
						var fullScreenIndex = layer.open({
							title : '添加燃气设备买卖',
							type: 2,
							closeBtn: 1, //不显示关闭按钮
							area : ['500px','300px'],
							content: '../rqDevTrade/addEditRqDevTrade.html',
							end : function(){
								if(addEditFlag){
									page.loadRqDevTradeList();
								}
							},
							cancel: function () {
								addEditFlag = false;
							}
						});
						layer.full(fullScreenIndex);
					},
					loadRqDevTradeList : function(){
						var _this = this;
						layer.load();
						var checkStaInp = $('#checkStaInp').val(),
							tankBandInp = $('#tankBandInp').val();
						var field = {compId:compId,lmId:lmId,zlId:zlId,checkSta:checkSta};
						console.log(field)
						table.render({
							elem: '#truckTradeTab',
							height: 'full-200',
							url : '/rqDevTrade/queryRqDevTrade',
							method : 'get',
							parseData : function(res){
								return {
									"code" : 0,
									"data" : res.datas,
									"count":res.count
								}
							},
							where:field,
							page : true,
							limit:20,
							even : true,
							text: {none : '暂无相关数据'},
							limits:[10,20,30,40],
							cols : [
								[
									{field : '', title: '序号',type:'numbers', align:'center'},
									
								]
							],
							done : function(res, curr, count){
								console.log(res)
								layer.closeAll('loading');
							}
						});
					}
				};
				page.init();
			});
		</script>
		
	</body>
</html>
