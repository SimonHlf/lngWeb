<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="../js/layui/css/layui.css"/>
		<link rel="stylesheet" type="text/css" href="../css/jgzz.css"/>
		<link rel="stylesheet" type="text/css" href="../js/pace/pace-theme-flash.min.css"/>
		<script src="../js/pace/pace.min.js" type="text/javascript" charset="utf-8"></script>
		<title>lng行情管理</title>
	</head>
	<body style="background:#f2f2f2;">
		<div class="layui-fluid" style="margin-top:15px;">
			<div class="layui-row">
				<div class="layui-card">
					<div class="layui-card-header posRel">
						<span class="itemDivs">lng行情管理</span>
					</div>
					<div class="layui-card-body">
						<div class="filter layui-clear" style="margin:0px 0 20px;">
							<div class="filterItem" style="width: 160px;">
								<div class="layui-input-inline" style="width: 160px;">
									<input id="provPyInp" type="text" class="layui-input" placeholder="请输入省拼音码" autocomplete="off"/>
									<a class="clearBtn clearProvBtn" href="javascript:void(0)" title="清空"><i class="layui-icon layui-icon-close"></i></a>
								</div>
							</div>
							<div class="filterItem" style="width: 160px;">
								<div class="layui-input-inline posRel" style="width: 160px;">
									<input id="ycPyInp" type="text" class="layui-input" placeholder="请输入液厂拼音码" autocomplete="off"/>
									<a class="clearBtn clearYcPyBtn" href="javascript:void(0)" title="清空"><i class="layui-icon layui-icon-close"></i></a>
								</div>
							</div>
							<div class="filterItem" style="width: 160px;">
								<input type="hidden" id="lqTypeInp" />
								<div class="layui-input-inline layui-form">
									<select id="lqTypeSel" lay-filter="lqTypeSel"> 
										<option value="">请选择液质类型</option>
								     </select>
								</div>
							</div>
							
							<div class="filterItem_spec" style="float:left;margin-right:15px;">
								<div class="layui-input-inline" style="width:130px;">
									 <input id="stDate" type="text" placeholder="请选择起始时间" readonly class="layui-input"/>
								</div>
								<span style="margin:0 5px;">至</span>
								<div class="layui-input-inline" style="width:130px;">
									 <input id="edDate" type="text" placeholder="请选择结束时间" readonly class="layui-input"/>
								</div>
							</div>
							
							<div class="filterItem">
								<div class="layui-input-inline">
									<button id="queryBtn" class="layui-btn"><i class="layui-icon layui-icon-search"></i></button>
								</div>
							</div>
							
						</div>
						<table id="lngTable" class="layui-table" lay-filter="lngTable"></table>
					</div>
				</div>
			</div>
		</div>
		
		
		<script type="text/javascript" src="../js/jquery-1.8.3.min.js" charset="utf-8"></script>
		<script src="../js/layui/layui.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			layui.use(['layer','table','form','laydate'],function(){
				var layer = layui.layer,form = layui.form,table=layui.table,laydate=layui.laydate;
				laydate.render({'elem':'#stDate'});
				laydate.render({'elem':'#edDate'});
				form.on('select(lqTypeSel)',function(data){
					data.value == '' ? $('#lqTypeInp').val('') : $('#lqTypeInp').val(data.value);
					page.loadLngData();
				});
				var page = {
					init : function(){
						this.loadLqTypeData();
						this.loadLngData();
						this.bindEvent();
					},
					bindEvent : function(){
						var _this = this;
						$('#queryBtn').on('click',function(){
							_this.loadLngData();
						});
						$('.clearYcPyBtn').on('click',function(){
							$('#ycPyInp').val('');
							_this.loadLngData();
						});
						$('.clearProvBtn').on('click',function(){
							$('#provPyInp').val('');
							_this.loadLngData();
						});
						
						$('#provPyInp').keyup(function (ev) {
							var keyWord=$('#provPyInp').val();
							clearTimeout(this.timer);
							layer.load();
							this.timer = setTimeout(function(){
								_this.loadLngData();
							}, 500);
						});
						
						$('#ycPyInp').keyup(function (ev) {
							var keyWord=$('#ycPyInp').val();
							clearTimeout(this.timer);
							layer.load();
							this.timer = setTimeout(function(){
								_this.loadLngData();
							}, 500);
						});
						
					},
					loadLqTypeData : function(){
						var _this = this;
						$.ajax({
							type:"get",
							data : { id:'' },
							dataType:"json",
							url:"/gasType/queryGasType",
							success:function (json){
								layer.closeAll('loading');
								if(json.code == 200){
									_this.renderLqTypeHtml(json.datas);
								}else if(json.code == 1000){
									layer.msg('服务器错误');
								}else if(json.code == 50001){
									$('#lqTypeSel').append('<option value="">请选择液质类型</option>');
								}
							}
						});
					},
					renderLqTypeHtml : function(list){
						if(list.length > 0){
							var strHtml = '';
							strHtml += '<option value="">请选择液质类型</option>';
							for(var i=0;i<list.length;i++){
								strHtml += '<option value="'+ list[i].id +'">'+ list[i].name +'</option>';
							}
							$('#lqTypeSel').html(strHtml);
							form.render();
						}else{
							$('#lqTypeSel').append('<option value="">请选择液质类型</option>');
						}
					},
					loadLngData : function(){
						var ycPyInp = $.trim($('#ycPyInp').val()),
							lqTypeInp = $('#lqTypeInp').val(),
							provPyInp = $.trim($('#provPyInp').val()),
							stDateInp = $('#stDate').val(),
							edDateInp = $('#edDate').val();
						var field = {gsNamePy:ycPyInp,gsId:lqTypeInp,provPy:provPyInp,priceDate:''};
						table.render({
							elem: '#lngTable',
							height: 'full-150',
							url : '/lng/getLngPriceData',
							method : 'get',
							parseData : function(res){
								return {
									"code" : 0,
									"data" : res.datas
								}
							},
							where:field,
							page : false,
							even : true,
							text: {none : '暂无相关数据'},
							cellMinWidth:150,
							cols : [
								[
									{field : '', title: '序号',type:'numbers', align:'center'},
									{field : 'gfName', title: '液厂名称',align:'center'},
									{field : 'province', title: '归属地',align:'center'},
									{field : 'gfType', title: '液质类型',align:'center'},
									{field : 'prePrice', title: '昨日价格',align:'center'},
									{field : 'currPrice', title: '今日价格',align:'center'},
									{field : 'nextPrice', title: '明日价格',align:'center'},
									{field : 'remark', title: '备注',align:'center'}
								]
							],
							done : function(res, curr, count){
								console.log(res)
								layer.closeAll('loading');
							}
						});
					}
				};
				page.init();
			});
		</script>
	</body>
</html>